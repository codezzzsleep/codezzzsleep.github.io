<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多媒体竞赛数据展示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6366F1',
                        accent: '#10B981',
                        neutral: '#1F2937',
                        'neutral-light': '#F3F4F6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
            }
            .badge {
                @apply px-2 py-1 rounded-full text-xs font-semibold;
            }
            .search-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary;
            }
            .page-btn {
                @apply w-9 h-9 flex items-center justify-center rounded-md transition-colors;
            }
            .page-btn-active {
                @apply bg-primary text-white;
            }
            .page-btn-inactive {
                @apply bg-gray-100 text-gray-700 hover:bg-gray-200;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-database text-primary text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold text-neutral">多媒体竞赛数据展示</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="refreshBtn" class="flex items-center space-x-1 px-3 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                    <i class="fa fa-refresh"></i>
                    <span>刷新数据</span>
                </button>
            </div>
        </div>
    </header>

    <!-- 筛选和搜索区域 -->
    <section class="bg-white py-4 border-b">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <div class="flex flex-wrap gap-3 items-center w-full md:w-auto">
                    <span class="text-gray-600">筛选：</span>
                    <button class="filter-btn badge bg-primary/10 text-primary hover:bg-primary/20 active" data-filter="all">全部</button>
                    <button class="filter-btn badge bg-gray-100 text-gray-700 hover:bg-gray-200" data-filter="multimedia_hashing">多媒体哈希</button>
                    <button class="filter-btn badge bg-gray-100 text-gray-700 hover:bg-gray-200" data-filter="image_video_quality_assessment">图像视频质量评估</button>
                    <button class="filter-btn badge bg-gray-100 text-gray-700 hover:bg-gray-200" data-filter="multimedia_security">多媒体安全</button>
                </div>
                
                <div class="relative w-full md:w-64">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="搜索项目..." 
                        class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 search-focus transition-all outline-none text-sm"
                    >
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- 主内容区域 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 加载状态 -->
        <div id="loading" class="flex flex-col items-center justify-center py-16">
            <div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
            <p class="mt-4 text-gray-600">正在获取数据...</p>
        </div>

        <!-- 错误状态 -->
        <div id="error" class="hidden flex-col items-center justify-center py-16 text-center">
            <i class="fa fa-exclamation-circle text-red-500 text-4xl"></i>
            <p class="mt-4 text-gray-600 text-lg">获取数据失败</p>
            <p class="mt-2 text-gray-500" id="errorMessage">请稍后重试</p>
            <button id="retryBtn" class="mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                重试
            </button>
        </div>

        <!-- 数据统计和更新时间 -->
        <div id="stats" class="hidden mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-700">项目统计</h2>
                <p class="text-sm text-gray-500 mt-2 md:mt-0 flex items-center">
                    <i class="fa fa-clock-o mr-1"></i>
                    最后更新: <span id="lastUpdated" class="ml-1 font-medium">--</span>
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <h3 class="text-gray-500 font-medium">总项目数</h3>
                        <i class="fa fa-list-alt text-primary text-xl"></i>
                    </div>
                    <p class="text-3xl font-bold mt-2" id="totalCount">0</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <h3 class="text-gray-500 font-medium">活跃项目</h3>
                        <i class="fa fa-check-circle text-accent text-xl"></i>
                    </div>
                    <p class="text-3xl font-bold mt-2" id="activeCount">0</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <h3 class="text-gray-500 font-medium">即将开始</h3>
                        <i class="fa fa-clock-o text-secondary text-xl"></i>
                    </div>
                    <p class="text-3xl font-bold mt-2" id="upcomingCount">0</p>
                </div>
            </div>
        </div>

        <!-- 数据列表 -->
        <div id="dataContainer" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- 数据卡片将通过JavaScript动态生成 -->
        </div>

        <!-- 分页控件 -->
        <div id="pagination" class="hidden mt-8 flex flex-col items-center">
            <div class="flex items-center gap-1 md:gap-2 mb-2">
                <button id="firstPage" class="page-btn page-btn-inactive" title="首页">
                    <i class="fa fa-angle-double-left"></i>
                </button>
                <button id="prevPage" class="page-btn page-btn-inactive" title="上一页">
                    <i class="fa fa-angle-left"></i>
                </button>
                <div id="pageNumbers" class="flex items-center gap-1 md:gap-2">
                    <!-- 页码按钮将通过JavaScript动态生成 -->
                </div>
                <button id="nextPage" class="page-btn page-btn-inactive" title="下一页">
                    <i class="fa fa-angle-right"></i>
                </button>
                <button id="lastPage" class="page-btn page-btn-inactive" title="末页">
                    <i class="fa fa-angle-double-right"></i>
                </button>
            </div>
            <p class="text-sm text-gray-500">
                显示 <span id="showingRange">0-0</span> 项，共 <span id="totalItems">0</span> 项
            </p>
        </div>

        <!-- 空状态 -->
        <div id="emptyState" class="hidden flex-col items-center justify-center py-16 text-center">
            <i class="fa fa-folder-open text-gray-300 text-5xl"></i>
            <p class="mt-4 text-gray-500 text-lg">没有找到符合条件的项目</p>
            <button id="clearSearchBtn" class="mt-4 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors hidden">
                清除搜索条件
            </button>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-neutral text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p>&copy; 2025 AI项目数据展示平台</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="hover:text-primary transition-colors"><i class="fa fa-github text-xl"></i></a>
                    <a href="#" class="hover:text-primary transition-colors"><i class="fa fa-twitter text-xl"></i></a>
                    <a href="#" class="hover:text-primary transition-colors"><i class="fa fa-linkedin text-xl"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // API URL
        const API_URL = 'https://shrill-cell-9967.codezzzsleep.workers.dev/';
        
        // 分页配置
        const ITEMS_PER_PAGE = 9; // 每页显示的项目数量
        
        // DOM元素
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const errorMessage = document.getElementById('errorMessage');
        const dataContainer = document.getElementById('dataContainer');
        const stats = document.getElementById('stats');
        const totalCount = document.getElementById('totalCount');
        const activeCount = document.getElementById('activeCount');
        const upcomingCount = document.getElementById('upcomingCount');
        const lastUpdated = document.getElementById('lastUpdated');
        const emptyState = document.getElementById('emptyState');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const retryBtn = document.getElementById('retryBtn');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const navbar = document.getElementById('navbar');
        const searchInput = document.getElementById('searchInput');
        const pagination = document.getElementById('pagination');
        const pageNumbers = document.getElementById('pageNumbers');
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        const firstPageBtn = document.getElementById('firstPage');
        const lastPageBtn = document.getElementById('lastPage');
        const showingRange = document.getElementById('showingRange');
        const totalItems = document.getElementById('totalItems');
        
        // 存储所有数据和状态变量
        let allData = [];
        let filteredData = []; // 经过筛选和搜索后的数据
        let lastUpdateTime = null;
        let currentFilter = 'all';
        let currentSearch = '';
        let currentPage = 1;
        let totalPages = 1;
        
        // 页面加载时获取数据
        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            
            // 监听滚动事件，改变导航栏样式
            window.addEventListener('scroll', () => {
                if (window.scrollY > 10) {
                    navbar.classList.add('py-2');
                    navbar.classList.remove('py-4');
                } else {
                    navbar.classList.add('py-4');
                    navbar.classList.remove('py-2');
                }
            });
            
            // 刷新按钮事件
            refreshBtn.addEventListener('click', () => {
                fetchData();
            });
            
            // 重试按钮事件
            retryBtn.addEventListener('click', () => {
                fetchData();
            });
            
            // 筛选按钮事件
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // 更新按钮样式
                    filterBtns.forEach(b => {
                        b.classList.remove('active', 'bg-primary/10', 'text-primary');
                        b.classList.add('bg-gray-100', 'text-gray-700');
                    });
                    btn.classList.add('active', 'bg-primary/10', 'text-primary');
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    
                    // 应用筛选，重置页码
                    currentFilter = btn.dataset.filter;
                    currentPage = 1;
                    applyFiltersAndRender();
                });
            });
            
            // 搜索框事件
            searchInput.addEventListener('input', (e) => {
                currentSearch = e.target.value.trim().toLowerCase();
                currentPage = 1; // 重置页码
                applyFiltersAndRender();
            });
            
            // 清除搜索按钮事件
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                currentSearch = '';
                currentPage = 1; // 重置页码
                applyFiltersAndRender();
            });
            
            // 分页按钮事件
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderCurrentPage();
                }
            });
            
            nextPageBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderCurrentPage();
                }
            });
            
            firstPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage = 1;
                    renderCurrentPage();
                }
            });
            
            lastPageBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage = totalPages;
                    renderCurrentPage();
                }
            });
        });
        
        // 从API获取数据
        async function fetchData() {
            try {
                // 显示加载状态
                showLoading();
                
                // 发送请求
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }
                
                const data = await response.json();
                
                // 检查数据是否有效
                if (data.success && Array.isArray(data.data)) {
                    allData = data.data;
                    lastUpdateTime = data.last_updated;
                    currentPage = 1; // 重置页码
                    updateStats(allData);
                    updateLastUpdated();
                    applyFiltersAndRender();
                } else {
                    throw new Error('数据格式不正确');
                }
            } catch (err) {
                console.error('获取数据失败:', err);
                showError(err.message);
            }
        }
        
        // 应用所有筛选条件并渲染
        function applyFiltersAndRender() {
            // 隐藏加载状态
            loading.classList.add('hidden');
            
            // 应用分类筛选和搜索
            filteredData = allData;
            
            // 应用分类筛选
            if (currentFilter !== 'all') {
                filteredData = filteredData.filter(item => item.relevance[currentFilter]);
            }
            
            // 应用搜索筛选
            if (currentSearch) {
                filteredData = filteredData.filter(item => {
                    const titleMatch = item.title.toLowerCase().includes(currentSearch);
                    const summaryMatch = item.summary_ai && item.summary_ai.toLowerCase().includes(currentSearch);
                    const tagMatch = item.tags_ai.some(tag => tag.toLowerCase().includes(currentSearch));
                    return titleMatch || summaryMatch || tagMatch;
                });
            }
            
            // 计算总页数
            totalPages = Math.max(1, Math.ceil(filteredData.length / ITEMS_PER_PAGE));
            
            // 确保当前页在有效范围内
            if (currentPage > totalPages) {
                currentPage = totalPages;
            }
            
            // 渲染当前页
            renderCurrentPage();
            
            // 更新分页控件
            updatePagination();
        }
        
        // 渲染当前页数据
        function renderCurrentPage() {
            // 清空容器
            dataContainer.innerHTML = '';
            
            // 检查是否有数据
            if (filteredData.length === 0) {
                showEmptyState();
                pagination.classList.add('hidden');
                return;
            }
            
            // 隐藏空状态，显示数据容器和分页
            emptyState.classList.add('hidden');
            dataContainer.classList.remove('hidden');
            pagination.classList.remove('hidden');
            stats.classList.remove('hidden');
            
            // 计算当前页的项目范围
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, filteredData.length);
            const currentItems = filteredData.slice(startIndex, endIndex);
            
            // 更新显示范围信息
            showingRange.textContent = `${startIndex + 1}-${endIndex}`;
            totalItems.textContent = filteredData.length;
            
            // 渲染当前页的每个项目
            currentItems.forEach(item => {
                const card = createProjectCard(item);
                dataContainer.appendChild(card);
            });
        }
        
        // 更新分页控件状态
        function updatePagination() {
            // 清空现有页码
            pageNumbers.innerHTML = '';
            
            // 生成页码按钮（最多显示5个页码）
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            // 如果接近末尾，调整起始页以显示5个页码
            if (endPage - startPage < 4 && startPage > 1) {
                startPage = Math.max(1, endPage - 4);
            }
            
            // 添加页码按钮
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'page-btn-active' : 'page-btn-inactive'}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    renderCurrentPage();
                    updatePagination();
                });
                pageNumbers.appendChild(pageBtn);
            }
            
            // 更新导航按钮状态
            prevPageBtn.className = `page-btn ${currentPage > 1 ? 'page-btn-inactive hover:bg-gray-200' : 'page-btn-inactive opacity-50 cursor-not-allowed'}`;
            nextPageBtn.className = `page-btn ${currentPage < totalPages ? 'page-btn-inactive hover:bg-gray-200' : 'page-btn-inactive opacity-50 cursor-not-allowed'}`;
            firstPageBtn.className = `page-btn ${currentPage > 1 ? 'page-btn-inactive hover:bg-gray-200' : 'page-btn-inactive opacity-50 cursor-not-allowed'}`;
            lastPageBtn.className = `page-btn ${currentPage < totalPages ? 'page-btn-inactive hover:bg-gray-200' : 'page-btn-inactive opacity-50 cursor-not-allowed'}`;
        }
        
        // 创建项目卡片
        function createProjectCard(item) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden card-hover';
            
            // 状态标签颜色
            const statusColor = item.status === 'Active' ? 'bg-green-100 text-green-800' : 
                               item.status === 'Upcoming' ? 'bg-blue-100 text-blue-800' : 
                               'bg-gray-100 text-gray-800';
            
            // 构建标签HTML
            const tagsHtml = item.tags_ai.map(tag => 
                `<span class="badge bg-gray-100 text-gray-700 mr-1 mb-1">${tag}</span>`
            ).join('');
            
            // 构建相关性标签HTML
            const relevanceHtml = Object.entries(item.relevance)
                .filter(([_, value]) => value)
                .map(([key, _]) => {
                    // 转换为中文显示
                    const labels = {
                        'multimedia_hashing': '多媒体哈希',
                        'image_video_quality_assessment': '图像视频质量评估',
                        'multimedia_security': '多媒体安全'
                    };
                    return `<span class="badge bg-primary/10 text-primary mr-1">${labels[key] || key}</span>`;
                })
                .join('');
            
            // 截止日期HTML
            const deadlinesHtml = Object.entries(item.deadlines)
                .filter(([_, value]) => value && value !== 'Not specified')
                .map(([key, value]) => {
                    const labels = {
                        'registration': '注册截止',
                        'submission': '提交截止',
                        'announcement': '结果公布'
                    };
                    return `
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fa fa-calendar-o mr-2 text-gray-400"></i>
                            <span>${labels[key]}: ${formatDate(value)}</span>
                        </div>
                    `;
                })
                .join('');
            
            // 设置卡片内容
            card.innerHTML = `
                <div class="p-5">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-semibold line-clamp-2">${item.title}</h3>
                        <span class="badge ${statusColor}">${item.status}</span>
                    </div>
                    
                    <div class="mb-3 text-sm text-gray-500 line-clamp-3">
                        ${item.summary_ai || '无描述信息'}
                    </div>
                    
                    <div class="mb-3">
                        <a href="${item.url}" target="_blank" class="text-primary hover:text-primary/80 text-sm flex items-center">
                            <i class="fa fa-external-link mr-1"></i>
                            ${item.source.replace('https://', '').replace('http://', '').slice(0, 30)}${item.source.length > 30 ? '...' : ''}
                        </a>
                    </div>
                    
                    ${deadlinesHtml ? `<div class="mb-3">${deadlinesHtml}</div>` : ''}
                    
                    <div class="mb-3">
                        <p class="text-xs text-gray-500 mb-1">发布日期: ${item.published_date || '未指定'}</p>
                    </div>
                    
                    <div class="mt-4">
                        <p class="text-xs text-gray-500 mb-1">相关性:</p>
                        <div class="flex flex-wrap">
                            ${relevanceHtml}
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <p class="text-xs text-gray-500 mb-1">标签:</p>
                        <div class="flex flex-wrap">
                            ${tagsHtml}
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // 更新统计信息
        function updateStats(data) {
            totalCount.textContent = data.length;
            
            const active = data.filter(item => item.status === 'Active').length;
            activeCount.textContent = active;
            
            const upcoming = data.filter(item => item.status === 'Upcoming').length;
            upcomingCount.textContent = upcoming;
        }
        
        // 更新最后更新时间
        function updateLastUpdated() {
            if (lastUpdateTime) {
                try {
                    const date = new Date(lastUpdateTime);
                    lastUpdated.textContent = date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (e) {
                    lastUpdated.textContent = lastUpdateTime;
                }
            }
        }
        
        // 显示加载状态
        function showLoading() {
            loading.classList.remove('hidden');
            error.classList.add('hidden');
            dataContainer.classList.add('hidden');
            stats.classList.add('hidden');
            emptyState.classList.add('hidden');
            pagination.classList.add('hidden');
        }
        
        // 显示错误状态
        function showError(message) {
            loading.classList.add('hidden');
            error.classList.remove('hidden');
            errorMessage.textContent = message || '获取数据失败，请稍后重试';
            dataContainer.classList.add('hidden');
            stats.classList.add('hidden');
            emptyState.classList.add('hidden');
            pagination.classList.add('hidden');
        }
        
        // 显示空状态
        function showEmptyState() {
            loading.classList.add('hidden');
            error.classList.add('hidden');
            dataContainer.classList.add('hidden');
            stats.classList.remove('hidden'); // 仍然显示统计信息
            
            // 显示或隐藏清除搜索按钮
            if (currentSearch) {
                clearSearchBtn.classList.remove('hidden');
            } else {
                clearSearchBtn.classList.add('hidden');
            }
            
            emptyState.classList.remove('hidden');
        }
        
        // 格式化日期
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (e) {
                return dateString;
            }
        }
    </script>
</body>
</html>
    
